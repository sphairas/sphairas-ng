<div class="page-content" style="height: calc(80vh - 10px)">

    <div *ngIf="service.data | async as file; else loading">

        <div class="content-section introduction">
            <div>
                <span class="feature-title">{{file.name}}</span>
                <span>{{file.type}}</span>
            </div>
        </div>

        <div *ngIf="recdata | async as table" class="content-section implementation">
            <p-table #recTable [columns]="table.columns" [scrollable]="true" scrollHeight="flex" frozenWidth="240px"
                [value]="table.rows">
                <ng-template pTemplate="frozencolgroup">
                    <colgroup>
                        <col style="width: 240px;" />
                    </colgroup>
                </ng-template>
                <ng-template pTemplate="colgroup">
                    <colgroup>
                        <col *ngFor="let col of table.columns" style="width: 45px;" />
                    </colgroup>
                </ng-template>
                <ng-template pTemplate="frozenheader">
                    <!-- style="height: 200px;" -->
                    <tr #frozenHeaderRow>
                        <th style="text-align: start;" class="th-vertical">Stunde</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="header">
                    <!-- style="height: 200px;" -->
                    <tr #scrollableHeaderRow>
                        <th *ngFor="let col of table.columns" style="overflow: visible; vertical-align: bottom;">
                            <div class="th-vertical">
                                {{col.name}}
                            </div>
                        </th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="frozenbody" let-row>
                    <tr #frozenRow>
                        <td>
                            <span>{{row.time | amLocale: 'de' | amDateFormat: 'dd., D. MMM'}}</span>
                            <span *ngIf="row.period"> {{row.period}}. Stunde</span>
                            <span *ngIf="!row.period"> um {{row.time | amLocale: 'de' | amDateFormat: 'H:mm'}}</span>
                            <span *ngIf="row.journal" class="sub-header"><br>{{truncate(row.journal, 41)}}</span>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-row>
                    <tr #scrollableRow>
                        <td pEditableColumn *ngFor="let col of table.columns"
                            style="text-align: center; vertical-align: middle;">
                            <!-- {{row.records[col.id]?.id}} -->
                            <grade-editor [value]="row.records[col.id]"
                                (valueChange)="gradeChange(row.id, col.id, $event)">
                            </grade-editor>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="frozenfooter" let-row>
                    <tr #scrollableFooter>
                        <td>
                            Bewertungen
                        </td>
                    </tr>
                    <tr #scrollableFooter>
                        <td>
                            Wert
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="footer" let-row>
                    <tr #scrollableFooter>
                        <td *ngFor="let col of table.columns" style="text-align: center; vertical-align: middle;">
                            {{(statistics[col.id]?.count | number: '1.0-2') || 0}}
                        </td>
                    </tr>
                    <tr #scrollableFooter>
                        <td *ngFor="let col of table.columns" style="text-align: center; vertical-align: middle;">
                            {{(statistics[col.id]?.value | number: '1.2-2') || '---'}}
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>

    <ng-template #loading>LÃ¤dt...</ng-template>
</div>